(()=>{"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"opps":"player",n=e.img.startsWith("profile_pics")?"/media/".concat(e.img):e.img;document.getElementById("".concat(t,"Avatar")).src=n,document.getElementById("".concat(t,"Name")).textContent=e.username,document.getElementById("".concat(t,"Elo")).textContent=e.elo,document.getElementById("".concat(t,"-btn")).style.display="flex"}var t;function n(n){var c=new WebSocket("wss://"+window.location.host+"/ws/game/ranked/"+n+"/");console.log("Matchmaking socket connected "+c.url);var a=setInterval((function(){userId&&c.readyState===WebSocket.OPEN&&(c.send(JSON.stringify({action:"join",player_id:"".concat(userId),game_type:n})),clearInterval(a)),o()}),100);c.onclose=function(e){console.log("Matchmaking socket closed")},c.onmessage=function(n){console.log("on message trigger");var o=JSON.parse(n.data);switch(console.log(o),o.type){case"matchFound":!function(n){!function(n){var o,c;e(n.player),e(n.opponent,!0),document.getElementById("vs-text").style.display="flex",document.getElementById("waiting-btn").style.display="none",document.getElementById("game-type").innerHTML="<h1>".concat(n.game_type,"</h1>"),o=document.getElementById("timer"),c=document.getElementById("timer-text"),[o,c].forEach((function(e){return e.style.display="flex"})),o.textContent=5,clearInterval(t),t=setInterval((function(){var e=parseInt(o.textContent);e>0?o.textContent=e-1:(o.textContent="Starting game...",clearInterval(t))}),1e3),setTimeout((function(){"flex"===document.getElementById("timer-text").style.display&&(window.location.href="https://"+window.location.host+"/game/".concat(n.game_type,"?id=").concat(n.game_id))}),5e3)}(n)}(o);break;case"gameStateUpdate":console.log("New game state:",o.state);break;case"matchmakingStatus":console.log("Matchmaking status:",o.status);break;case"opponentDisconnected":console.log("Opponent disconnected");var a=document.getElementById("overlay"),l=document.getElementById("timer"),d=document.getElementById("timer-text"),r=document.getElementById("reconnect"),m=document.getElementById("cancel");[l,d].forEach((function(e){return e.style.display="none"})),[r,m,a].forEach((function(e){return e.style.display="flex"})),c.close(1e3);break;default:console.log("Unknown message type:",o.type)}},c.onerror=function(e){console.error("WebSocket error:",e)};var l=setInterval((function(){if(c.readyState===WebSocket.OPEN){console.log("send message");try{c.send(JSON.stringify({action:"heartbeat",player_id:"".concat(userId)}))}catch(e){console.error("Error while sending heartbeat")}}}),3e3);document.addEventListener("htmx:beforeSwap",(function(e){c.close(),console.log("htmx:beforeSwap event listener matchMakingSocket close"),l=clearInterval(l)}),{once:!0})}function o(){var e=document.getElementById("loadingText"),t=(e.textContent.match(/\./g)||[]).length;e.textContent=t<3?"Waiting for players"+".".repeat(t+1):"Waiting for players."}var c=setInterval(o,500);document.getElementById("connect4-button").addEventListener("click",(function(){console.log("connect4-button clicked"),n("connect4");var e=document.getElementById("game-chooser"),t=document.getElementById("wrap"),o=document.getElementById("player-btn"),c=document.getElementById("opps-btn"),a=document.getElementById("game-type"),l=document.getElementById("vs-text"),d=document.getElementById("waiting-btn");[o,c,a,l,e].forEach((function(e){return e.style.display="none"})),[t,d].forEach((function(e){return e.style.display="flex"}))})),document.getElementById("pong-button").addEventListener("click",(function(){console.log("pong-button clicked"),n("pong");var e=document.getElementById("game-chooser"),t=document.getElementById("wrap"),o=document.getElementById("player-btn"),c=document.getElementById("opps-btn"),a=document.getElementById("game-type"),l=document.getElementById("vs-text"),d=document.getElementById("waiting-btn");[o,c,a,l,e].forEach((function(e){return e.style.display="none"})),[t,d].forEach((function(e){return e.style.display="flex"}))})),document.getElementById("reconnect").addEventListener("click",(function(){console.log("reconnect clicked"),n();var e=document.getElementById("player-btn"),t=document.getElementById("opps-btn"),o=document.getElementById("game-type"),c=document.getElementById("vs-text"),a=document.getElementById("waiting-btn"),l=document.getElementById("overlay"),d=document.getElementById("wrap");[e,t,o,c,l].forEach((function(e){return e.style.display="none"})),[d,a].forEach((function(e){return e.style.display="flex"}))})),document.getElementById("cancel").addEventListener("click",(function(){console.log("cancel clicked"),document.getElementById("game-chooser").style.display="flex",document.getElementById("wrap").style.display="none",document.getElementById("overlay").style.display="none"})),document.addEventListener("htmx:beforeSwap",(function(e){console.log("htmx:beforeSwap event listener clear interval"),clearInterval(c)}),{once:!0})})();