(()=>{"use strict";function e(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"opps":"player",n=e.img.startsWith("profile_pics")?"/media/".concat(e.img):e.img;document.getElementById("".concat(t,"Avatar")).src=n,document.getElementById("".concat(t,"Name")).textContent=e.username,document.getElementById("".concat(t,"Elo")).textContent=e.elo,document.getElementById("".concat(t,"-btn")).style.display="flex"}var t;function n(){var n=new WebSocket("ws://"+window.location.host+"/ws/game/ranked");console.log("Matchmaking socket connected "+n.url);var c=setInterval((function(){userId&&n.readyState===WebSocket.OPEN&&(n.send(JSON.stringify({action:"join",player_id:"".concat(userId)})),clearInterval(c)),o()}),100);n.onclose=function(e){console.log("Matchmaking socket closed")},n.onmessage=function(o){console.log("on message trigger");var c=JSON.parse(o.data);switch(console.log(c),c.type){case"matchFound":!function(n){!function(n){var o,c;e(n.player),e(n.opponent,!0),document.getElementById("vs-text").style.display="flex",document.getElementById("waiting-btn").style.display="none",document.getElementById("game-type").innerHTML="<h1>".concat(n.game_type,"</h1>"),o=document.getElementById("timer"),c=document.getElementById("timer-text"),[o,c].forEach((function(e){return e.style.display="flex"})),o.textContent=5,clearInterval(t),t=setInterval((function(){var e=parseInt(o.textContent);e>0?o.textContent=e-1:(o.textContent="Starting game...",clearInterval(t))}),1e3),setTimeout((function(){"flex"===document.getElementById("timer-text").style.display&&(window.location.href="https://localhost/game/".concat(n.game_type,"?id=").concat(n.game_id))}),5e3)}(n)}(c);break;case"gameStateUpdate":console.log("New game state:",c.state);break;case"matchmakingStatus":console.log("Matchmaking status:",c.status);break;case"opponentDisconnected":console.log("Opponent disconnected");var a=document.getElementById("overlay"),l=document.getElementById("timer"),r=document.getElementById("timer-text"),d=document.getElementById("reconnect"),s=document.getElementById("cancel");[l,r].forEach((function(e){return e.style.display="none"})),[d,s,a].forEach((function(e){return e.style.display="flex"})),n.close(1e3);break;default:console.log("Unknown message type:",c.type)}},n.onerror=function(e){console.error("WebSocket error:",e)};var a=setInterval((function(){if(n.readyState===WebSocket.OPEN){console.log("send message");try{n.send(JSON.stringify({action:"heartbeat",player_id:"".concat(userId)}))}catch(e){console.error("Error while sending heartbeat")}}}),3e3);document.addEventListener("htmx:beforeSwap",(function(e){n.close(),console.log("htmx:beforeSwap event listener matchMakingSocket close"),a=clearInterval(a)}),{once:!0})}function o(){var e=document.getElementById("loadingText"),t=(e.textContent.match(/\./g)||[]).length;e.textContent=t<3?"Waiting for players"+".".repeat(t+1):"Waiting for players."}var c=setInterval(o,500);document.getElementById("connect4-button").addEventListener("click",(function(){console.log("connect4-button clicked"),n();var e=document.getElementById("game-chooser"),t=document.getElementById("wrap"),o=document.getElementById("player-btn"),c=document.getElementById("opps-btn"),a=document.getElementById("game-type"),l=document.getElementById("vs-text"),r=document.getElementById("waiting-btn");[o,c,a,l,e].forEach((function(e){return e.style.display="none"})),[t,r].forEach((function(e){return e.style.display="flex"}))})),document.getElementById("reconnect").addEventListener("click",(function(){console.log("reconnect clicked"),n();var e=document.getElementById("player-btn"),t=document.getElementById("opps-btn"),o=document.getElementById("game-type"),c=document.getElementById("vs-text"),a=document.getElementById("waiting-btn"),l=document.getElementById("overlay"),r=document.getElementById("wrap");[e,t,o,c,l].forEach((function(e){return e.style.display="none"})),[r,a].forEach((function(e){return e.style.display="flex"}))})),document.getElementById("cancel").addEventListener("click",(function(){console.log("cancel clicked"),document.getElementById("game-chooser").style.display="flex",document.getElementById("wrap").style.display="none",document.getElementById("overlay").style.display="none"})),document.addEventListener("htmx:beforeSwap",(function(e){console.log("htmx:beforeSwap event listener clear interval"),clearInterval(c)}),{once:!0})})();